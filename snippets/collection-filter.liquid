<script>
    (function(){
        window.shopifyData = window.shopifyData || {};
        {% if collection %}
            window.shopifyData.collection = {{ collection.products | json }};
        {% endif %}

        const searchParams = new URL(window.location.href).searchParams;
        window.shopifyData.filters = {};
        for(const [key, value] of searchParams){
            if(key in ['size', 'color']){
                window.shopifyData.filters[key] = value;
            }
            else if(key == 'sort'){
                window.shopifyData.sort = value;
            }
        }
        if(window.shopifyData.filters){
            //filter
        }
        if(window.shopifyData.sort){
            //sort
        }

        //generate full list of filters
        window.shopifyData.filterOptions = {};
        for(filter of ['Size', 'Color']){
            window.shopifyData.filterOptions[filter] = window.shopifyData.collection.reduce(function(prev, curr, cI){
                const optionIndex = curr.options.indexOf(filter);
                for (variant of curr.variants){
                    if(variant.options[optionIndex]){
                        prev.add(variant.options[optionIndex])
                    }
                }
                return prev;
            }, new Set());
        }
    })();

    document.addEventListener('DOMContentLoaded', () => {
        document.querySelectorAll('select.filter').forEach((filterSelectElt) => {
            const filter = filterSelectElt.dataset.filter;
            console.log(filter)
            console.log(window.shopifyData.filterOptions)
            for (filterOption of window.shopifyData.filterOptions[filter]){
                const filterOptionElt = document.createElement('option')
                filterOptionElt.setAttribute('value', filterOption)
                filterOptionElt.appendChild(document.createTextNode(filterOption))
                filterSelectElt.appendChild(filterOptionElt)
            }
        })
    })

</script>
